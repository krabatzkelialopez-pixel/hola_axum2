<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin | Axum Motors</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

<div class="sidebar">
    <h2>Axum Motors</h2>
    <a href="/index.html">游 Inicio</a>
    <a href="/motos.html">游끬 Motos</a>
    <a href="/otros.html">游 Otros</a>
    <a href="/contacto.html">九괦잺 Contacto</a>
    <a href="/admin.html" class="active">游늶 Admin</a>
</div>

<div class="main-content">
    <div class="page-title">Panel de Administraci칩n</div>
    
    <div class="admin-tools">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Buscar por nombre..." onkeyup="filtrarTabla()">
        </div>
        <button class="btn-create" onclick="window.location.href='/contacto.html'">
            <span>+</span> Nuevo Registro
        </button>
    </div>

    <div class="table-container">
        <table class="admin-table" id="tablaMensajes">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Mensaje</th>
                    <th style="text-align: center;">Acciones</th>
                </tr>
            </thead>
            <tbody id="mensajes-table"></tbody>
        </table>

        <div class="pagination">
            <button id="btnPrev" onclick="cambiarPagina(-1)">Anterior</button>
            <span id="pageInfo">P치gina 1 de 1</span>
            <button id="btnNext" onclick="cambiarPagina(1)">Siguiente</button>
        </div>
    </div>
</div>

<script>
let mensajesData = []; 
let datosFiltrados = [];
let paginaActual = 1;
const registrosPorPagina = 5; // <--- Cambia este n칰mero seg칰n prefieras

async function cargarMensajes() {
    const res = await fetch("/mensajes");
    mensajesData = await res.json();
    datosFiltrados = [...mensajesData];
    renderizarTabla();
}

function renderizarTabla() {
    const tbody = document.getElementById("mensajes-table");
    tbody.innerHTML = "";

    // L칩gica de paginaci칩n
    const inicio = (paginaActual - 1) * registrosPorPagina;
    const fin = inicio + registrosPorPagina;
    const paginados = datosFiltrados.slice(inicio, fin);

    paginados.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td class="id-cell">#${m.id}</td>
            <td class="name-cell">${m.nombre}</td>
            <td class="msg-cell">${m.mensaje}</td>
            <td class="actions-cell">
                <button class="btn-delete" onclick="eliminarMensaje(${m.id})">游딈 Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });

    actualizarControles();
}

function actualizarControles() {
    const totalPaginas = Math.ceil(datosFiltrados.length / registrosPorPagina) || 1;
    document.getElementById("pageInfo").innerText = `P치gina ${paginaActual} de ${totalPaginas}`;
    
    document.getElementById("btnPrev").disabled = paginaActual === 1;
    document.getElementById("btnNext").disabled = paginaActual === totalPaginas;
}

function cambiarPagina(direccion) {
    paginaActual += direccion;
    renderizarTabla();
}

function filtrarTabla() {
    const busqueda = document.getElementById("searchInput").value.toLowerCase();
    datosFiltrados = mensajesData.filter(m => 
        m.nombre.toLowerCase().includes(busqueda) || 
        m.mensaje.toLowerCase().includes(busqueda)
    );
    paginaActual = 1; // Resetear a la primera p치gina al buscar
    renderizarTabla();
}

async function eliminarMensaje(id) {
    if (!confirm("쮼liminar este registro?")) return;
    await fetch(`/mensajes/${id}`, { method: "DELETE" });
    cargarMensajes();
}

cargarMensajes();
</script>

</body>
</html>