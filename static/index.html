<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Axum Motors</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

    <header>
        <a href="/" class="logo-container">
            <img src="/img/logo.png" alt="Axum Motors Logo" class="site-logo">
        </a>
        <p>Venta de motos nuevas y seminuevas</p>
    </header>

    <div class="hero">
        <div class="hero-content">
            <h2>Siente la <span class="highlight">Potencia</span></h2>
            <p>Descubre nuestra nueva colecciÃ³n 2026 con financiamiento exclusivo.</p>
            <a href="/motos.html" class="btn-hero">Ver CatÃ¡logo</a>
        </div>
    </div>

    <section id="catalogo">
        <h2>ðŸ”¥ Modelos Destacados</h2>
        <div class="catalogo">
            <div class="moto">
                <img src="/uploads/mo1.jpg" alt="Moto 1">
                <div class="moto-info">
                    <h3>Deportiva 1000cc</h3>
                    <p>Velocidad y aerodinÃ¡mica pura.</p>
                    <span class="price">$245,000</span>
                    <br><br>
                    <a href="/motos.html" class="btn">Ver MÃ¡s</a>
                </div>
            </div>
            <div class="moto">
                <img src="/uploads/scot12.jpg" alt="Scooter">
                <div class="moto-info">
                    <h3>Scooter Urbano</h3>
                    <p>Ideal para la ciudad y el trÃ¡fico.</p>
                    <span class="price">$45,000</span>
                    <br><br>
                    <a href="/otros.html" class="btn">Ver MÃ¡s</a>
                </div>
            </div>
            <div class="moto">
                <img src="/uploads/nk1.jpg" alt="Naked">
                <div class="moto-info">
                    <h3>Naked 900cc</h3>
                    <p>Estilo agresivo y manejo cÃ³modo.</p>
                    <span class="price">$195,000</span>
                    <br><br>
                    <a href="/motos.html" class="btn">Ver MÃ¡s</a>
                </div>
            </div>
        </div>
    </section>

    <section>
        <h2>ðŸ“¸ Motos de nuestros clientes</h2>
        
        <form id="uploadForm" enctype="multipart/form-data" style="margin-bottom: 20px;">
            <h3>Sube tu foto</h3>
            <input type="file" name="file" accept="image/*" required>
            <button type="submit">Subir Foto</button>
            <div id="uploadMsg" class="msg"></div>
        </form>

        <div class="grid" id="gallery">
            </div>
    </section>

    <section id="contacto">
        <h2>ðŸ“© ContÃ¡ctanos</h2>
        <form id="contactForm">
            <label>Nombre:</label>
            <input type="text" name="nombre" required placeholder="Tu nombre">
            
            <label>Mensaje:</label>
            <textarea name="mensaje" rows="4" required placeholder="Escribe tu consulta..."></textarea>
            
            <div class="g-recaptcha" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"></div>
            
            <button type="submit" style="margin-top:15px;">Enviar Mensaje</button>
            <div id="statusMsg" class="msg"></div>
        </form>
    </section>

    <a href="https://wa.me/525512345678?text=Hola,%20vi%20una%20moto%20en%20Axum%20Motors%20y%20me%20interesa..." 
    class="btn-wsp" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    </a>

    <div id="lightbox" class="lightbox" onclick="cerrarLightbox()">
        <span class="close-lightbox">&times;</span>
        <img class="lightbox-content" id="img-grande">
    </div>

    <footer>
        <p>Â© 2026 Axum Motors</p>
        <br>
        <a href="/admin" style="color: #444; font-size: 0.8rem; text-decoration: none;">Acceso Personal</a>
    </footer>

    <script>
        // --- Formulario Contacto ---
        document.getElementById("contactForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const msgDiv = document.getElementById("statusMsg");
            
            // Convertir FormData a URLSearchParams para x-www-form-urlencoded
            const params = new URLSearchParams();
            for(const pair of formData) {
                params.append(pair[0], pair[1]);
            }

            try {
                const res = await fetch("/enviar", {
                    method: "POST",
                    body: params
                });
                const text = await res.text();
                
                msgDiv.innerHTML = text;
                msgDiv.className = text.includes("âœ…") ? "msg success" : "msg error";
                
                if (text.includes("âœ…")) e.target.reset(); // Limpiar si fue exitoso
                
            } catch (err) {
                msgDiv.innerText = "Error de conexiÃ³n";
                msgDiv.className = "msg error";
            }
        });

        // --- Subida de ImÃ¡genes ---
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const msgDiv = document.getElementById("uploadMsg");

            try {
                const res = await fetch("/upload-image", {
                    method: "POST",
                    body: formData
                });
                
                // Si el servidor devuelve HTML (como en tu cÃ³digo Rust actual)
                const text = await res.text(); 
                
                msgDiv.innerHTML = text;
                msgDiv.className = text.includes("âœ…") ? "msg success" : "msg error";

                if (text.includes("âœ…")) {
                    e.target.reset();
                    loadImages(); // Recargar galerÃ­a
                }
            } catch (err) {
                msgDiv.innerText = "Error subiendo imagen";
                msgDiv.className = "msg error";
            }
        });

        // --- Cargar GalerÃ­a y Lightbox ---
        async function loadImages() {
            const res = await fetch("/images");
            if (!res.ok) return;

            const images = await res.json();
            const gallery = document.getElementById("gallery");
            gallery.innerHTML = "";

            images.forEach(img => {
                const div = document.createElement("div");
                div.className = "moto";
                // AÃ±adimos onclick para abrir el lightbox
                div.innerHTML = `<img src="/uploads/${img.filename}" 
                    onclick="abrirLightbox('/uploads/${img.filename}')" 
                    style="cursor:pointer">`;
                gallery.appendChild(div);
            });
        }

        function abrirLightbox(src) {
            const lightbox = document.getElementById("lightbox");
            const imgGrande = document.getElementById("img-grande");
            lightbox.style.display = "block";
            imgGrande.src = src;
        }

        function cerrarLightbox() {
            document.getElementById("lightbox").style.display = "none";
        }

        // Iniciar
        loadImages();
    </script>
</body>
</html>